<?xml version="1.0" encoding="UTF-8"?>
<project name="TestNG-reset-passwords" default="" basedir=".">
	
	<property name="libdir" location="lib" />
	
	<path id="classpath.jdbcdriver">
		<fileset dir="${libdir}">
			<include name="**/jtds-1.2.3.jar" />
		</fileset>
	</path>
	
	
	<!--
		A first test of running upgrade scripts against DBs.
		To be used after DBs have been retored.
		
		1. Restore DBs.
		
		2. Upgrade DBs.
		
		3. Run auto tests.
		
	-->

	
	
	<!--
		Reset the employee passwords in a database
	-->
	<target name="reset-passwords-test5">
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_Midland</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_Midland"/>
			<param name="company-database" value="AUTO_TEST5_Midland"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		<echo>starting reset of employee passwords in test5 - TEST5_Midland</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/TEST5_Midland"/>
			<param name="company-database" value="TEST5_Midland"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_NationalGrid</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_NationalGrid"/>
			<param name="company-database" value="AUTO_TEST5_NationalGrid"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
			
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_SL</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_SL"/>
			<param name="company-database" value="AUTO_TEST5_SL"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_TUI</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_TUI"/>
			<param name="company-database" value="AUTO_TEST5_TUI"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_Telefonica</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_Telefonica"/>
			<param name="company-database" value="AUTO_TEST5_Telefonica"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_Enterprise</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_Enterprise"/>
			<param name="company-database" value="AUTO_TEST5_Enterprise"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_NALCO</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_NALCO"/>
			<param name="company-database" value="AUTO_TEST5_NALCO"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<!--
		<echo>starting reset of employee passwords in test5 - AUTO_TEST5_SCB</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/AUTO_TEST5_SCB"/>
			<param name="company-database" value="AUTO_TEST5_SCB"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
			-->
		
		
		<echo>starting reset of employee passwords in test5 - TEST5_OFFSHORE1</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/TEST5_OFFSHORE1"/>
			<param name="company-database" value="TEST5_OFFSHORE1"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - TEST5_OFFSHORE2</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/TEST5_OFFSHORE2"/>
			<param name="company-database" value="TEST5_OFFSHORE2"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - TEST5_OFFSHORE4</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/TEST5_OFFSHORE4"/>
			<param name="company-database" value="TEST5_OFFSHORE4"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
		
		<echo>starting reset of employee passwords in test5 - TEST5_OFFSHORE6</echo>
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://vtest-db3:1433/TEST5_OFFSHORE6"/>
			<param name="company-database" value="TEST5_OFFSHORE6"/>
			<param name="meta-database" value="TEST5_META"/>
		</antcall>
		
	</target>
	
	
	<!--target name="reset-passwords-local">
		
		
		<antcall target="reset-passwords">
			<param name="database-url" value="jdbc:jtds:sqlserver://SL004976:1433/TRUNK_ULTRA"/>
			<param name="company-database" value="TRUNK_ULTRA"/>
			<param name="meta-database" value="TRUNK_META"/>
		</antcall>
		
	</target-->
	
	
	<target name="reset-passwords">
		
		<echo>starting reset of employee passwords in database: ${company-database}</echo>
		
		<echo>${company-database} - dropping resetPasswords SP</echo>
		<sql
			driver="net.sourceforge.jtds.jdbc.Driver"
			url="${database-url}"
			userid="autotest"
			password="autotest"
			classpathref="classpath.jdbcdriver"
			autocommit="true"
			print="true"
			keepformat="true"
			>
			
			EXEC dropStoredProcedure resetPasswords
		</sql>
		
		
		<echo>${company-database} - creating resetPasswords SP</echo>
		<sql
			driver="net.sourceforge.jtds.jdbc.Driver"
			url="${database-url}"
			userid="autotest"
			password="autotest"
			classpathref="classpath.jdbcdriver"
			autocommit="true"
			print="true"
			keepformat="true"
			src="Maintenance/password-reset.sql"
			>
			
		</sql>
		
		
		<echo>${company-database} - calling resetPasswords SP</echo>
		<sql
			driver="net.sourceforge.jtds.jdbc.Driver"
			url="${database-url}"
			userid="autotest"
			password="autotest"
			classpathref="classpath.jdbcdriver"
			autocommit="true"
			print="true"
			>
			
			exec resetPasswords ${meta-database}
		</sql>
		
		
		<echo>${company-database} - dropping resetPasswords SP</echo>
		<sql
			driver="net.sourceforge.jtds.jdbc.Driver"
			url="${database-url}"
			userid="autotest"
			password="autotest"
			classpathref="classpath.jdbcdriver"
			autocommit="true"
			print="true"
			keepformat="true"
			>
			
			EXEC dropStoredProcedure resetPasswords
		</sql>
		
	</target>
	
</project>
